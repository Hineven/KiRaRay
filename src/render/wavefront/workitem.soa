flat int;
flat uint;
flat float;
flat BSDFType;
flat bool;
flat double;

flat Light;
flat Medium;
flat MediumInterface;
flat PhaseFunction;
flat MaterialType;
flat LCGSampler;
flat PCGSampler;
flat HaltonSampler;
flat SampledChannel;

flat Vector2f;
flat Vector3f;
flat Color;

struct LightSampleContext{ Vector3f p, n; };

struct Ray{ 
	Vector3f origin;
	Vector3f dir; 
	float time;
	Medium medium;
};

struct PixelState {
	Color L;
	PCGSampler sampler;
	SampledChannel channel;
};

struct BSDFData {
	float IoR;
	Color diffuse;	
	Color specular;
	float specularTransmission;
	float roughness;
	float metallic;
	float anisotropic;
	MaterialType bsdfType;
};

struct SurfaceInteraction {
	Vector3f p;
	Vector3f wo;
	Vector3f n;
	Vector2f uv;
	float time;
	const MediumInterface* mediumInterface;
	const MaterialData* material;
	Medium medium;
	Vector3f tangent;
	Vector3f bitangent;
	Light light;
	BSDFData sd;
};

struct RayWorkItem {
	Ray ray;
	LightSampleContext ctx;
	Color thp;
	Color pu, pl;
	BSDFType bsdfType;
	uint depth;
	uint pixelId;
};

struct MissRayWorkItem {
	Ray ray;
	LightSampleContext ctx;
	Color thp;
	Color pu, pl;
	BSDFType bsdfType;
	uint depth;
	uint pixelId;
};

struct HitLightWorkItem {
	Light light;
	LightSampleContext ctx;
	Vector3f p;
	Vector3f wo;
	Vector3f n;
	Vector2f uv;
	Color thp;
	Color pu, pl;
	BSDFType bsdfType;
	uint depth;
	uint pixelId;
};

struct ShadowRayWorkItem {
	Ray ray;
	float tMax;
	Color Ld;
	Color pu, pl;
	uint pixelId;
};

struct ScatterRayWorkItem {
	Color thp;
	Color pu;
	SurfaceInteraction intr;
	uint depth;
	uint pixelId;
};

struct MediumSampleWorkItem {
	Ray ray;
	LightSampleContext ctx;
	Color thp;
	Color pu, pl;
	float tMax;
	SurfaceInteraction intr;
	BSDFType bsdfType;
	uint depth;
	uint pixelId;
};

struct MediumScatterWorkItem {
	Vector3f p;
	Color thp;
	Color pu;
	Vector3f wo;
	float time;
	Medium medium;
	PhaseFunction phase;
	uint depth;
	uint pixelId;
};